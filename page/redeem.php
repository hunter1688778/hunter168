<head>
    <link rel="stylesheet" href="https://imba96.bet/account/assets/css/font/font-style.css">
    <link rel="stylesheet" href="system/css/style.css">
    <style>
        body {
            background-color: #000;
            color: #fff;
        }
        /* รวม CSS ที่กล่าวไว้ข้างต้น */
    </style>
</head>


</head>
<body class="mgMenuBottom">

    <span class="bglight"></span>

    <!-- HEADER -->
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6">

                <div class="header">
            

                    <div class="rightNav">



                        </span>


                        </a>
                        <div class="grad_color01 listLanguage">
                            <a href="#" data-lang="th" data-icon="https://imba96.bet/account/assets/images/icon-th.svg">
                                <img src="https://imba96.bet/account/assets/images/icon-th.svg" alt="">
                                <span>ภาษาไทย</span>
                            </a>
                            <a href="#" data-lang="en" data-icon="https://imba96.bet/account/assets/images/icon-en.svg">
                                <img src="https://imba96.bet/account/assets/images/icon-en.svg" alt="">
                                <span>English</span>
                            </a>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>

       <style>
      .box-cooldown {
         width:100%;
         max-width: 500px;
         margin: 10px auto;
         font-weight: 100;
         background: #FFCC00;
         color: #000;
         padding: 10px;
         border-radius: 10px;
         font-size: 14px;
         box-shadow: 0 0 10px black;
         font-weight:300;
      }

      .qrcode {
         width: 100% !important;
         margin-bottom: 10px !important;
         max-width: 200px !important;
      }

      .banknameCard {
         display: flex;
         align-items: center;
         justify-content: space-between;
         margin: 5px;
      }

      #p_show_amount {
         color:#37ff00;
         font-size: 24px;
         font-weight: bold;
      }

   </style>
      <div class="container" data-aos="fade-up">
         <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="backLink mb-3">
                    <a href="http://localhost/0/account.php/">

                    </a>
                </div>

                <div class="titlePage">
                    <h2>ฝากขั้นต่ำ 1 บาท</h2>
                    <img src="https://img5.pic.in.th/file/secure-sv1/qrrrrrrr.png" alt="ข้อความอธิบายภาพ" width="200" height="200">
                </div>
                </button>  
                        <!-- uploadqr -->
                        <div class="alert alertbankbg text-center mt-3" role="alert">
                          <i class="fas fa-wallet"></i>
                          <strong>เติมเงินออโต้ หลังจากโอนเงินแล้วให้ทำการ</strong> <span v-if="fnameslip" id="fname" style="font-size: 1.2em; color: darkgreen;"> <strong>กดปุ่มสีเขียวแนปสลิป</strong> </span> <strong> เครดิตจะเข้าทันที </strong>
                          <br>
                          <button type="button" class="btn btn-success mt-2 my-2" onclick="document.getElementById('slipfile').click();">
                            <span> <i class="fas fa-wallet"></i> แนบสลิป </span>
                          </button> 
                          <input type="file" class="mt-2 select_imgs" @change="handleUpload1" accept="image/*" style="display:none;" id="slipfile">
                        </div>
            </div>
         </div>

         <div class="row justify-content-center">
            <div class="col-md-5">


                <div class="cardBlock">
                    <img src="https://imba96.bet/account/assets/images/icon-page-deposit.svg" alt="" class="imgPage">

                    <div id="box_loadding" style="justify-content:center;text-align: center;">
                  
                    </div>
                    <div id="box_promptpay_input" style="justify-content:center;">
                        <div class="formInput">
                           
                           <a onclick="deposit()" id="btn-withdraw" class="btn btn-danger d-block mt-3 btn-danger1">แจ้งฝาก</a>
                        </div>
                    </div>

                    <div id="box_promptpay_info" style="justify-content:center;">
                        <div class="banknameCard" id="p_show_amount" style="justify-content:center;">
                        </div>
                        <div class="banknameCard countdown" style="justify-content:center;">
                        </div>
                        <div class="banknameCard" id="p_qrcode" style="justify-content:center;">
                        </div>
                        <div class="banknameCard" id="p_btn" style="justify-content:center;">
                        </div>
     
                     </div>

                    <hr>

                    <div class="bankBottom" style="justify-content:center;font-weight:bold;color:lime;">
                        <div class="accountBank">
                            <h6>** ค่าย PUSH GAMING ถอนได้สูงสุด 10 เท่าจากยอดฝาก **</h6>
                        </div>
                    </div>

                    <a href="http://localhost/index.php" class="btn btn-outline-light d-block mt-3">กลับหน้าหลัก</a>
                    
                </div>


                <div class="mt-4 mb-4 cardColorDark">
                    <p>ขั้นตอนการฝากเงิน</p>
                    <ul>
                        <li>1. สแกน Qrcode เพื่อฝากเงิน</li>
                        <li>2. กรอกจำนวนเงิน จากนั้นกดโอนเงิน</li>
                        <li>3. รอ 1-3 นาที หากยอดไม่เข้าให้ติดต่อแอดมิน</li>
                    </ul>
                    <small class="text-muted">* หากเงินไม่เข้าเกินกว่า 5 นาทีให้ติดต่อแอดมิน</small>
                    <a href="https://lin.ee/Wy5SyDu" class="btn-flat btn-flat-block">
                        <img src="https://imba96.bet/account/assets/images/menu-icon-05.svg" alt="">
                        <span>ติดต่อแอดมิน</span>
                    </a>
                </div>

            </div>
        </div>
      </div>

   <style>
      .box-cooldown {
         width:100%;
         max-width: 500px;
         margin: 10px auto;
         font-weight: 900 !important;
         background: #FFCC00;
         color: #000;
         padding: 10px;
         border-radius: 5px;
         font-size: 14px;
         box-shadow: 0 0 10px black;
         font-weight:300;
         text-align: center;
      }

      .qrcode {
         width: 100% !important;
         margin-bottom: 10px !important;
         max-width: 200px !important;
      }


   </style>
   
   <link href="https://imba96.bet/account//assets/framework/toastify/toastify.min.css" rel="stylesheet">
   <script src="https://imba96.bet/account/assets/js/jquery-3.7.1.min.js"></script>
   <script src="https://imba96.bet/account//assets/framework/toastify/toastify.min.js"></script>
   <script>
      var ticker;
      var timeInSecs;
      var depositStatusInterval;

      const getBankDeposit = () => {
         $(`#box_loadding`).show()
         return new Promise((resolve, reject) => {
            $.ajax({
                url: "/account/bitpay/checkdeposit",
                type: "POST",
                dataType: 'json',
            }).done(function(res) {
                let {
                    status,
                    message,
                    data
                } = res;
                if(status == 200) {
                    if (data.length != 0) {
                        let sec = parseInt(data.expiration_duration.m) * 60
                        sec += parseInt(data.expiration_duration.s)
                        startTimer(sec);
                        activePromptpay()
                        $(`#p_show_amount`).html(`ยอดโอนเงิน ${convertNumberFormat(data.real_amount)} บาท`);
                        $(`#p_qrcode`).html(`<img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${data.qrcode}" class="qrcode"/>`);
                        $(`#p_btn`).html(`<button class="btn btn-primary mt-2" onclick="downloadQrcode('https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${data.qrcode}', 'qr-${data.amount}')">โหลดคิวอาร์</button>`);
                
                        depositStatusInterval = setInterval(() => {
                                                   checkStatus()
                                                }, 5000);
                    } else {
                        $(`#box_promptpay_input`).show()
                        $(`#box_promptpay_info`).hide()
                    }
                } else {
                    return alert(message)
                }
                $(`#box_loadding`).hide()
                resolve()
            }).fail(function(err) {
                console.log(err);
                reject();
            })
        })
      }

      async function toDataURL(url) {
         const blob = await fetch(url).then(res => res.blob());
         return URL.createObjectURL(blob);
      }

      async function downloadQrcode(url, name) {
         const a = document.createElement("a");
         a.href = await toDataURL(url);
         a.download = `${name}.jpg`;
         document.body.appendChild(a);
         a.click();
         document.body.removeChild(a);
         console.log('dddd');
         
      }

      const deposit = () => {
         let amount = $(`#p_amount`).val();
         $(`#box_loadding`).show()
         $(`#box_promptpay_input, #box_promptpay_info`).hide()
         $.ajax({
               url: "/account/bitpay/insert",
               type: "POST",
               dataType: 'json',
               data: { amount },
            }).done(function(res) {
                let {
                    status,
                    message,
                    data
                } = res;
                if(status == 200) {
                   if (data.length != 0) {
                     let sec = parseInt(data.expiration_duration.m) * 60
                        sec += parseInt(data.expiration_duration.s)
                        startTimer(sec);
                        activePromptpay()
                        $(`#p_show_amount`).html(`ยอดโอนเงิน ${convertNumberFormat(data.real_amount)} บาท`);
                        $(`#p_qrcode`).html(`<img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${data.qrcode}" class="qrcode"/>`);
                        $(`#p_btn`).html(`<button class="btn btn-primary mt-2" onclick="downloadQrcode('https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${data.qrcode}', 'qr-${data.amount}')">โหลดคิวอาร์</button>`);
                        depositStatusInterval = setInterval(() => {
                           checkStatus()
                        }, 5000);

                    } else {
                        $(`.loadding`).prop( "disabled", false );
                        $(`.loadding`).html(`ฝากเงิน (ฝากขั้นต่ำ 1 บาท)`)
                        return alert(message)
                    }
                } else {
                     $(`.loadding`).prop( "disabled", false );
                     $(`.loadding`).html(`ฝากเงิน (ฝากขั้นต่ำ 1 บาท)`)
                     location.reload();
                    return alert(message)
                }
                $(`#box_loadding`).hide()
            }).fail(function(err) {
               $(`.loadding`).prop( "disabled", false );
               $(`.loadding`).html(`ฝากเงิน (ฝากขั้นต่ำ 1 บาท)`)
               console.log(err);
            })
      }

      const activePromptpay = () => {
         $(`#box_promptpay_input`).hide()
         $(`#box_promptpay_info`).show()
      }



      const convertNumberFormat = (v) => {
         if(v == null) {
            return 0
         }
         let number = parseFloat(v)
         let formatted = number.toLocaleString('th-Th', {maximumFractionDigits: 2})
         return formatted
      }


      function startTimer(secs) {
         timeInSecs = parseInt(secs);
         ticker = setInterval("tick()", 1000);
      }

      function tick() {
         let secs = timeInSecs;
         if (secs > 0) {
            timeInSecs--;
         } else {
            clearInterval(ticker);
            location.reload();
         }

         let mins = Math.floor(secs / 60);
         secs %= 60;
         let result = (mins < 10 ? "0" : "") + mins + ":" + (secs < 10 ? "0" : "") + secs;
         $(`.countdown`).html(`กรุณาโอนภายในเวลา ${result}`);
      }


      const initData = async() => {
         await getBankDeposit();
      }
      initData()

      
      const checkStatus = () => {
            $.ajax({
               url: "/account/bitpay/checkstatus",
               type: "POST",
               dataType: 'json',
            }).done(function(res) {
               let {
                    status,
                    message,
                    data
                } = res;
                if(status == 200) { 
                  if(data.status == 1) {
                     clearInterval(depositStatusInterval);
                     alert(`สำเร็จ! คุณได้รับ ${convertNumberFormat(data.real_amount)} เครดิต`);
                     location.reload();
                     return
              
                  }

                  if(data.status == 2) {
                     clearInterval(depositStatusInterval);
                     alert('เติมเครดิตไม่สำเร็จ กรุณาติดต่อแอดมิน');
                     location.reload();
                     return
                  }

                  if(data.status == 3) {
                     clearInterval(depositStatusInterval);
                     alert('รายการฝากถูกยกเลิก กรุณาทำรายการฝากใหม่อีกครั้ง');
                     location.reload();
                     return
                  
                  }

                  
        
                } else {
                  clearInterval(depositStatusInterval);
                  alert('เกิดข้อผิดพลาดในระบบ กรุณารีโหลดเว็บไซต์');
                  location.reload();
                  return
                }
   
            });
      }
    </script> 

    <div class="footer color-secondary">
        
    </div>






    <!-- Bootstrap Framework -->
    <script src="https://imba96.bet/account/assets/js/jquery-3.7.1.min.js"></script>
    <script src="https://imba96.bet/account/assets/js/popper.min.js"></script>

    <!-- Framework JS -->
    <script src="https://imba96.bet/account/assets/framework/bootstrap-5.3.3-dist/js/bootstrap.min.js"></script>
    <script src="https://imba96.bet/account/assets/framework/aos-master/aos.js"></script>
    <script src="https://imba96.bet/account/assets/framework/fontawesome/js/all.min.js"></script>

    <!-- Default JS -->
    <script src="https://imba96.bet/account/assets/js/apps.js"></script>
    <script>
        $(document).ready(function(){
            $('.language').click(function(e){
                e.preventDefault();
                $(this).next('.listLanguage').next('.listLanguage').toggleClass('show');
            });

            $('.listLanguage a').click(function(e){
                e.preventDefault();
                var selectedIcon = $(this).data('icon');
                var selectedLang = $(this).data('lang');
                let path = window.location.pathname;
                $('.language img').attr('src', selectedIcon);
                $('.listLanguage').removeClass('show');
                window.location.replace(`https://imba96.bet/account/lang/${selectedLang}?path=${path}`);
            });

            $(document).click(function(e) {
                if (!$(e.target).closest('.language, .listLanguage').length) {
                    $('.listLanguage').removeClass('show');
                }
            });
        });

        var isReloadBalance = false;
        const refresh_balance = () => {  
            if(isReloadBalance) {
                return true;
            }
            isReloadBalance = true;
            $(".current_balance").html("<i class='fa fa-spinner fa-spin'></i>");
            $(".current_point").html("<i class='fa fa-spinner fa-spin'></i>");         
            $.ajax({
                
                type: "POST",
                dataType: 'json',
            }).done(function(res) {
                $(".current_balance").html(Number(res.balance).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                $(".current_point").html(Number(res.point).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                setTimeout(() => {
                    isReloadBalance = false;
                }, 6000);
            })      
        }  
        refresh_balance();  



        setInterval(() => {
            checkSession()
        }, 10000);
    </script>

</body>

</html>